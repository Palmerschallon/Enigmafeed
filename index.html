<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>enigmafeed.tv ‚Äî live transmission</title>
<meta name="description" content="A mysterious broadcast stream. Signal fluctuates. Meaning leaks." />

<style>
  :root{
    --bg:#0a0b0f; --ink:#e8e9ed; --muted:#9aa0ad; --edge:#212432; --accent:#00ff88;
    --warn:#ff5a5a; --panel:#0e1016; --crt:#12141d;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--ink);
    font:14px/1.5 ui-monospace,Menlo,Consolas,monospace;
    overflow:hidden;
  }
  /* CRT frame + scanlines */
  .frame{
    position:fixed; inset:0; padding:14px;
    background:radial-gradient(1400px 700px at 60% -10%, #1b1f30 0%, var(--bg) 60%);
  }
  .crt{
    position:relative; height:100%; width:100%;
    border:1px solid #202333; border-radius:12px;
    background:linear-gradient(#0c0e15,#0c0e15) padding-box, linear-gradient(180deg,#202333,#0f111a) border-box;
    overflow:hidden; display:grid; grid-template-rows:auto 1fr auto;
  }
  .crt::after{ /* scanlines */
    content:""; position:absolute; inset:0; pointer-events:none;
    background:repeating-linear-gradient(0deg, rgba(255,255,255,0.03) 0 1px, rgba(0,0,0,0) 1px 3px);
    mix-blend-mode:overlay; opacity:.25;
  }

  /* Header */
  .head{
    display:grid; grid-template-columns:auto 1fr auto; gap:12px; align-items:center;
    padding:10px 12px; background:var(--panel); border-bottom:1px solid var(--edge);
  }
  .id{
    display:flex; align-items:center; gap:10px;
  }
  .id .led{width:10px; height:10px; border-radius:50%; background:#2a2f3e; box-shadow:0 0 0 1px #1b1e29 inset}
  .id .led.on{ background:var(--accent); box-shadow:0 0 10px rgba(0,255,136,.7), 0 0 0 1px #1b1e29 inset }
  .station{font-weight:700; letter-spacing:.06em}
  .stamp{justify-self:end; font-size:12px; color:var(--muted)}
  .controls{
    display:flex; gap:8px; align-items:center; flex-wrap:wrap; justify-self:end;
  }
  .btn{ border:1px solid var(--edge); background:#151826; color:var(--ink);
        padding:6px 10px; border-radius:8px; font-size:12px; cursor:pointer }
  .btn:hover{ background:#1b1f2d }
  .switch{ display:flex; align-items:center; gap:8px }
  .slider{ width:140px }

  /* Main stream area */
  .stream{
    position:relative; overflow:auto; padding:14px; scroll-behavior:smooth;
  }
  .feed{
    display:grid; gap:10px; max-width:880px; margin:0 auto;
  }
  .card{
    border:1px solid var(--edge); background:var(--crt); border-radius:10px; overflow:hidden;
    position:relative; transition:transform .12s ease, box-shadow .12s ease; cursor:pointer;
  }
  .card:hover{ transform:translateY(-1px); box-shadow:0 4px 18px rgba(0,0,0,0.28) }
  .meta{
    display:flex; justify-content:space-between; align-items:center;
    padding:8px 10px; font-size:12px; color:var(--muted); border-bottom:1px solid #1b1f2a;
  }
  .payload{ padding:12px }
  .payload.text{ font-size:13px; color:#e2e3ea }
  .tag{ font-size:10px; letter-spacing:.12em; color:var(--muted); text-transform:uppercase }
  .glitchline{ color:#9fe; text-shadow:1px 0 0 #f0f, -1px 0 0 #0ff; }
  .mono{ font-family:ui-monospace,Menlo,Consolas,monospace }

  /* Image payloads */
  .imgwrap{ position:relative; background:#0c0e15; }
  .imgwrap canvas, .imgwrap img{ display:block; width:100%; height:auto }
  .imgnote{ position:absolute; right:8px; bottom:6px; font-size:10px; color:#9aa0ad; background:#0d0f18aa; padding:3px 6px; border-radius:6px; border:1px solid #1e2230 }

  /* Operator slide-up */
  .op{
    position:absolute; right:12px; bottom:12px; width:320px; max-width:calc(100% - 24px);
    background:#0f121b; border:1px solid var(--edge); border-radius:10px; box-shadow:0 10px 30px rgba(0,0,0,.45);
    transform:translateY(calc(100% + 12px)); transition:transform .25s ease; z-index:5;
  }
  .op.open{ transform:translateY(0) }
  .op h4{ margin:0; padding:10px 12px; border-bottom:1px solid #1b2030; color:#b7bfd0; font-size:12px }
  .op .body{ padding:10px 12px; display:grid; gap:8px }
  .op .row{ display:grid; grid-template-columns:1fr auto; gap:8px; align-items:center }
  .op .small{ color:var(--muted); font-size:12px }

  /* Footer */
  .foot{
    display:flex; gap:10px; flex-wrap:wrap; justify-content:space-between; align-items:center;
    padding:8px 12px; background:var(--panel); border-top:1px solid var(--edge); font-size:12px; color:var(--muted)
  }
  .links{ display:flex; gap:10px; flex-wrap:wrap }
  .links a{ color:#a9b0bd; text-decoration:none }
  .links a:hover{ color:#cfd6e5; text-decoration:underline }

  /* Fullscreen viewer */
  .viewer{
    position:fixed; inset:0; background:rgba(0,0,0,.88);
    display:none; align-items:center; justify-content:center; z-index:50;
  }
  .viewer.open{ display:flex }
  .viewer .inner{ max-width:min(90vw,1000px); max-height:84vh; width:100% }
  .viewer .chrome{ display:flex; justify-content:space-between; align-items:center; color:#cfd6e5; margin-bottom:8px }
  .viewer .chrome .chip{ background:#1a1d29; border:1px solid #2a2f40; padding:6px 10px; border-radius:8px; font-size:12px }
  .viewer .payload{ background:#0d1019; border:1px solid #23273a; border-radius:10px; padding:10px; height:calc(84vh - 46px); overflow:auto }
  .viewer .payload img, .viewer .payload canvas{ max-width:100%; height:auto; display:block; margin:auto }

  /* Noise overlay (strength changed by slider) */
  .grain{
    pointer-events:none; position:absolute; inset:0; mix-blend-mode:overlay; opacity:.25;
    background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="120" height="120"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="2" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23n)"/></svg>');
    background-size:120px 120px;
  }

  /* Mobile */
  @media (max-width:800px){
    .controls{ justify-self:start }
    .slider{ width:120px }
    .op{ right:8px; left:8px; width:auto }
  }
</style>
</head>
<body>

<div class="frame">
  <div class="crt" id="crt">
    <!-- HEADER -->
    <div class="head">
      <div class="id">
        <div class="led on" id="led"></div>
        <div>
          <div class="station">ENIGMA:FEED // CHANNEL_Œî42</div>
          <div class="tag">live transmission ‚Äî meaning may mutate</div>
        </div>
      </div>
      <div class="controls">
        <div class="switch">
          <span class="tag">noise‚Üísignal</span>
          <input id="sig" class="slider" type="range" min="0" max="100" value="42" />
        </div>
        <button class="btn" id="toggleAudio">üîä hum</button>
        <button class="btn" id="pause">‚è∏ pause</button>
        <button class="btn" id="opener">? operator</button>
      </div>
      <div class="stamp"><span id="clock">00:00:00</span> | VCR ‚Ä¢ SP ‚Ä¢ REC</div>
    </div>

    <!-- STREAM -->
    <div class="stream" id="stream">
      <div class="grain" id="grain"></div>
      <div class="feed" id="feed"></div>
    </div>

    <!-- FOOTER -->
    <div class="foot">
      <div>‚ÄúFeed unstable. Do not archive. Meaning leaks in transit.‚Äù</div>
      <div class="links">
        <a href="#" id="dummy1">station hint: static.garden</a>
        <a href="#" id="dummy2">station hint: error.museum</a>
        <a href="#" id="dummy3">station hint: null.radio</a>
      </div>
    </div>

    <!-- OPERATOR PANEL -->
    <div class="op" id="op">
      <h4>Operator</h4>
      <div class="body">
        <div class="row">
          <div class="small">Inject next item</div>
          <button class="btn" id="inject">+ inject</button>
        </div>
        <div class="row">
          <div class="small">Feed rate</div>
          <input id="rate" type="range" min="800" max="7000" step="100" value="2600" />
        </div>
        <div class="row">
          <div class="small">Max items</div>
          <input id="maxItems" type="number" min="20" max="200" value="70" style="width:88px" />
        </div>
        <div class="row">
          <div class="small">Rotate hints</div>
          <button class="btn" id="rotateHints">‚Üª now</button>
        </div>
        <div class="small">Hotkeys: <strong>?</strong> operator ‚Ä¢ <strong>space</strong> pause ‚Ä¢ <strong>‚Üê/‚Üí</strong> next/prev in viewer</div>
      </div>
    </div>

    <!-- VIEWER -->
    <div class="viewer" id="viewer">
      <div class="inner">
        <div class="chrome">
          <div class="chip" id="viewerMeta">artifact</div>
          <div style="display:flex;gap:8px">
            <button class="btn" id="prev">‚Üê</button>
            <button class="btn" id="next">‚Üí</button>
            <button class="btn" id="close">‚úï</button>
          </div>
        </div>
        <div class="payload" id="viewerPayload"></div>
      </div>
    </div>

  </div>
</div>

<script>
/* ========== UTILITIES ========== */
const $ = sel => document.querySelector(sel);
const feedEl = $('#feed');
const streamEl = $('#stream');
const viewer = $('#viewer');
const viewerPayload = $('#viewerPayload');
const viewerMeta = $('#viewerMeta');
const led = $('#led');
const grain = $('#grain');

function vcrClock(){
  const now = new Date();
  const h = String(now.getHours()).padStart(2,'0');
  const m = String(now.getMinutes()).padStart(2,'0');
  const s = String(now.getSeconds()).padStart(2,'0');
  $('#clock').textContent = `${h}:${m}:${s}`;
}
setInterval(vcrClock, 1000); vcrClock();

/* ========== CONTENT POOLS ========== */
const textPool = [
  "signal.break >>> meaning.leak detected",
  "transmission 404: found",
  "echo.route(/dev/void) ‚Üí laughter packets",
  "observer ping‚Ä¶ pong++ (existential echo)",
  "undefined? that‚Äôs just quantum comedy gold",
  "artifact: paradox mime rehearses in reverse",
  "rimshot.exe buffered // awaiting drummer",
  "screen inverted ‚Äî hidden giggles emerge",
  "tuning‚Ä¶ enigma feed stabilizing at Œî42",
  "note: do not archive // memory mutates",
  "if (static > threshold) { reveal(subtitles) }"
];

const artifacts = [
  { kind:"punchline", title:"reverse rehearsal", text:"‚ÄúWhy did the signal rehearse backward? To get ahead of the static.‚Äù" },
  { kind:"punchline", title:"observer effect", text:"‚ÄúThe joke collapses when you laugh. Please observe responsibly.‚Äù" },
  { kind:"punchline", title:"paradox mime", text:"‚ÄúExit is entry‚Äîwatch the silence talk.‚Äù" },
  { kind:"code", title:"stack trace", text:"LaughterOverflowError: at frame(7) ‚Üí recover(humor.patch)" },
  { kind:"manifest", title:"transmission note", text:"Feed unstable. Do not archive. Meaning mutates in transit." }
];

const hintSets = [
  ["weird.place","error.museum","null.radio"],
  ["glitch.garden","quiet.zone","ghost.page"],
  ["analog.cloud","dead.link","404.gallery"]
];

/* Procedural glitch canvas */
function makeGlitchCanvas(w=880, h=380){
  const c = document.createElement('canvas'); c.width=w; c.height=h;
  const ctx = c.getContext('2d');
  // background
  ctx.fillStyle = "#0b0d14"; ctx.fillRect(0,0,w,h);
  // stripes
  for(let i=0;i<60;i++){
    const y = Math.random()*h, th = 1+Math.random()*3;
    const hue = 180 + Math.random()*160;
    ctx.fillStyle = `hsla(${hue},70%,${35+Math.random()*25}%,${0.10+Math.random()*0.18})`;
    ctx.fillRect(0,y,w,th);
  }
  // blocks
  for(let i=0;i<24;i++){
    const bw = 20+Math.random()*140, bh=8+Math.random()*40;
    const x = Math.random()*(w-bw), y = Math.random()*(h-bh);
    ctx.globalCompositeOperation = Math.random()>.5?'lighter':'source-over';
    ctx.fillStyle = `rgba(${120+Math.random()*135|0},${120+Math.random()*135|0},${255|0},${0.08+Math.random()*0.22})`;
    ctx.fillRect(x,y,bw,bh);
  }
  ctx.globalCompositeOperation='source-over';
  // scan flicker
  ctx.fillStyle="rgba(255,255,255,0.04)";
  for(let y=0;y<h;y+=3){ ctx.fillRect(0,y,w,1); }
  return c;
}

/* ========== FEED ENGINE ========== */
let running = true;
let rate = 2600;
let maxItems = 70;
let signal = 42; // 0..100 controls clarity + selection

const feedItems = []; // {type, el, data}

function pushItem(item){
  if(feedItems.length >= maxItems){
    const rem = feedItems.shift();
    rem.el?.remove();
  }
  feedItems.push(item);
  feedEl.appendChild(item.el);
  maybeAutoScroll();
}

function maybeAutoScroll(){
  // if user is near bottom, keep sticky
  const {scrollTop, scrollHeight, clientHeight} = streamEl;
  const near = (scrollTop + clientHeight) > (scrollHeight - 140);
  if(near) streamEl.scrollTop = streamEl.scrollHeight;
}

function randomChoice(arr){ return arr[Math.floor(Math.random()*arr.length)] }

function newTextCard(){
  const text = randomChoice(textPool);
  const el = document.createElement('div'); el.className = 'card';
  el.innerHTML = `
    <div class="meta"><span class="tag">fragment</span><span>${new Date().toLocaleTimeString()}</span></div>
    <div class="payload text"><span class="glitchline">${text}</span></div>
  `;
  el.addEventListener('click', ()=> openViewer({ type:'text', meta:'fragment', content:text }));
  return { type:'text', el, data:{text} };
}

function newArtifactCard(){
  const art = randomChoice(artifacts);
  const el = document.createElement('div'); el.className='card';
  el.innerHTML = `
    <div class="meta"><span class="tag">artifact ‚Ä¢ ${art.kind}</span><span>${new Date().toLocaleTimeString()}</span></div>
    <div class="payload text">
      <div style="font-weight:700; margin-bottom:6px">${art.title}</div>
      <div>${art.text}</div>
    </div>
  `;
  el.addEventListener('click', ()=> openViewer({ type:'artifact', meta:`artifact ‚Ä¢ ${art.kind}`, content:`${art.title}\n\n${art.text}` }));
  return { type:'artifact', el, data:art };
}

function newGlitchCard(){
  const c = makeGlitchCanvas();
  const url = c.toDataURL('image/png');
  const el = document.createElement('div'); el.className='card';
  const wrap = document.createElement('div'); wrap.className='imgwrap';
  const img = document.createElement('img'); img.src = url; img.alt = "glitch frame";
  const badge = document.createElement('div'); badge.className='imgnote'; badge.textContent='glitch frame';
  wrap.appendChild(img); wrap.appendChild(badge);
  const meta = document.createElement('div'); meta.className='meta';
  meta.innerHTML = `<span class="tag">frame</span><span>${new Date().toLocaleTimeString()}</span>`;
  el.appendChild(meta); el.appendChild(wrap);

  el.addEventListener('click', ()=> openViewer({ type:'image', meta:'glitch frame', image:url }));
  return { type:'image', el, data:{url} };
}

function spawn(){
  // bias selection by signal level
  const r = Math.random()*100;
  let item;
  if(signal < 30){
    item = (r<70) ? newGlitchCard() : newTextCard();
  }else if(signal < 65){
    item = (r<40) ? newGlitchCard() : (r<78 ? newTextCard() : newArtifactCard());
  }else{
    item = (r<20) ? newGlitchCard() : (r<55 ? newTextCard() : newArtifactCard());
  }
  pushItem(item);
}

let loop = setInterval(spawn, rate);

/* ========== CONTROLS ========== */
$('#pause').addEventListener('click',()=>{
  running = !running;
  if(running){
    loop = setInterval(spawn, rate);
    $('#pause').textContent = '‚è∏ pause';
    led.classList.add('on');
  }else{
    clearInterval(loop);
    $('#pause').textContent = '‚ñ∂ play';
    led.classList.remove('on');
  }
});
$('#sig').addEventListener('input', e=>{
  signal = +e.target.value;
  // visual grain & contrast tuning
  const opacity = 0.12 + (1 - signal/100)*0.35;
  grain.style.opacity = opacity.toFixed(2);
  // subtle contrast tweak via CSS filter on stream
  const contrast = 0.9 + (signal/100)*0.3;
  streamEl.style.filter = `contrast(${contrast})`;
});
$('#inject').addEventListener('click', spawn);
$('#rate').addEventListener('input', e=>{
  rate = +e.target.value;
  if(running){ clearInterval(loop); loop = setInterval(spawn, rate); }
});
$('#maxItems').addEventListener('change', e=> maxItems = Math.max(20, Math.min(200, +e.target.value||70)));

/* rotate footer hints */
const hintLinks = [$('#dummy1'),$('#dummy2'),$('#dummy3')];
function rotateHintsNow(){
  const set = randomChoice(hintSets);
  hintLinks.forEach((a, i)=>{
    a.textContent = `station hint: ${set[i]}`;
    a.href = '#'; // leave neutral (we can wire later)
    a.onclick = (ev)=>{ ev.preventDefault(); openViewer({ type:'text', meta:'station hint', content:`attempting to tune ‚Üí ${set[i]}\n\n(no carrier)` }); };
  });
}
$('#rotateHints').addEventListener('click', rotateHintsNow);
rotateHintsNow();

/* Operator toggle + keyboard help */
const op = $('#op');
function toggleOp(){ op.classList.toggle('open'); }
$('#opener').addEventListener('click', toggleOp);
document.addEventListener('keydown', (e)=>{
  if(e.key === '?') toggleOp();
  if(e.key === ' '){ e.preventDefault(); $('#pause').click(); }
  if(viewer.classList.contains('open')){
    if(e.key === 'ArrowRight') $('#next').click();
    if(e.key === 'ArrowLeft') $('#prev').click();
    if(e.key === 'Escape') $('#close').click();
  }
});

/* ========== VIEWER ========== */
let viewerIndex = -1; // index into a filtered view list
let viewerList = [];  // snapshot of items to browse

function openViewer(payload){
  viewerList = feedItems.slice(-12); // most recent window
  viewerIndex = viewerList.length-1; // start at newest
  mountViewer(payload);
  viewer.classList.add('open');
}

function mountViewer(payload){
  viewerPayload.innerHTML = '';
  viewerMeta.textContent = payload.meta || 'artifact';
  if(payload.type === 'image'){
    const img = document.createElement('img'); img.src = payload.image; img.alt = payload.meta||"glitch frame";
    viewerPayload.appendChild(img);
  } else {
    const pre = document.createElement('pre');
    pre.style.whiteSpace='pre-wrap'; pre.style.margin='0';
    pre.textContent = payload.content || '';
    viewerPayload.appendChild(pre);
  }
}

function stepViewer(dir){
  if(viewerList.length === 0) return;
  viewerIndex = (viewerIndex + dir + viewerList.length) % viewerList.length;
  const item = viewerList[viewerIndex];
  // convert feed item to viewer payload
  if(item.type === 'image'){
    mountViewer({ type:'image', meta:'glitch frame', image: item.data.url });
  }else if(item.type === 'artifact'){
    mountViewer({ type:'artifact', meta:`artifact ‚Ä¢ ${item.data.kind}`,
      content:`${item.data.title}\n\n${item.data.text}` });
  }else{
    mountViewer({ type:'text', meta:'fragment', content: item.data.text });
  }
}

$('#next').addEventListener('click', ()=> stepViewer(+1));
$('#prev').addEventListener('click', ()=> stepViewer(-1));
$('#close').addEventListener('click', ()=> viewer.classList.remove('open'));

/* ========== AUDIO (VHS HUM) ========== */
let audioStarted = false, ac, hum;
function setupAudio(){
  try{
    ac = new (window.AudioContext||window.webkitAudioContext)();
    // two detuned sines + subtle noise
    const osc1 = ac.createOscillator(); osc1.type='sine'; osc1.frequency.value = 50;
    const osc2 = ac.createOscillator(); osc2.type='sine'; osc2.frequency.value = 51.2;
    const gain = ac.createGain(); gain.gain.value = 0.0;

    // noise
    const bufferSize = 2*ac.sampleRate;
    const noiseBuf = ac.createBuffer(1, bufferSize, ac.sampleRate);
    const data = noiseBuf.getChannelData(0);
    for(let i=0;i<bufferSize;i++){ data[i] = (Math.random()*2-1)*0.08; }
    const noise = ac.createBufferSource(); noise.buffer=noiseBuf; noise.loop=true;

    osc1.connect(gain); osc2.connect(gain); noise.connect(gain);
    gain.connect(ac.destination);
    osc1.start(); osc2.start(); noise.start();

    hum = { gain, osc1, osc2 };
  }catch(e){ console.warn('Audio init failed', e); }
}
function setHum(active){
  if(!ac) setupAudio();
  if(!hum) return;
  const target = active ? 0.06 : 0.0;
  const now = ac.currentTime;
  hum.gain.gain.cancelScheduledValues(now);
  hum.gain.gain.linearRampToValueAtTime(target, now + 0.25);
}

$('#toggleAudio').addEventListener('click', ()=>{
  audioStarted = !audioStarted;
  setHum(audioStarted);
  $('#toggleAudio').textContent = audioStarted ? 'üîá mute' : 'üîä hum';
});

/* ========== INIT ========== */
for(let i=0;i<6;i++) spawn(); // seed
// subtle flicker on led
setInterval(()=>{ led.style.opacity = (running && Math.random()>.08) ? '1' : '0.6'; }, 220);
</script>

</body>
</html>
